apiVersion: apiextensions.k8s.io/v1 # Hack because controller-gen complains if we don't have this
name: "MachineConfigPoolProgressInsight"
crdName: machineconfigpoolprogressinsights.update.openshift.io
featureGate: UpgradeStatus
tests:
  onCreate:
  - name: Should be able to create a minimal MachineConfigPoolProgressInsight
    initial: |
      apiVersion: update.openshift.io/v1alpha1
      kind: MachineConfigPoolProgressInsight
      spec: {} # No spec is required for a MachineConfigPoolProgressInsight
    expected: |
      apiVersion: update.openshift.io/v1alpha1
      kind: MachineConfigPoolProgressInsight
      spec: {}
  onUpdate:
  - name: MachineConfigPoolProgressInsight example
    initial: |
      apiVersion: update.openshift.io/v1alpha1
      kind: MachineConfigPoolProgressInsight
      spec: {}
    updated: |
      apiVersion: update.openshift.io/v1alpha1
      kind: MachineConfigPoolProgressInsight
      metadata:
        name: worker
      spec: {}
      status:
        name: worker
        conditions:
        - type: Updating
          status: "False"
          lastTransitionTime: "2021-01-01T00:00:00Z"
          reason: Updated
          message: "All nodes on version 4.18.0"
        scopeType: WorkerPool
        assessment: Completed
        completionPercent: 100
        summaries:
        - type: Total
          count: 3
        - type: Available
          count: 3
        - type: Progressing
          count: 0
        - type: Outdated
          count: 0
        - type: Draining
          count: 0
        - type: Excluded
          count: 0
        - type: Degraded
          count: 0
    expected: |
      apiVersion: update.openshift.io/v1alpha1
      kind: MachineConfigPoolProgressInsight
      spec: {}
      metadata:
        name: worker
      status:
        name: worker
        conditions:
        - type: Updating
          status: "False"
          lastTransitionTime: "2021-01-01T00:00:00Z"
          reason: Updated
          message: "All nodes on version 4.18.0"
        scopeType: WorkerPool
        assessment: Completed
        completionPercent: 100
        summaries:
        - type: Total
          count: 3
        - type: Available
          count: 3
        - type: Progressing
          count: 0
        - type: Outdated
          count: 0
        - type: Draining
          count: 0
        - type: Excluded
          count: 0
        - type: Degraded
          count: 0
#  - name: Name and .status.name must match
#    initial: |
#      apiVersion: update.openshift.io/v1alpha1
#      kind: MachineConfigPoolProgressInsight
#      spec: {}
#    updated: |
#      apiVersion: update.openshift.io/v1alpha1
#      kind: MachineConfigPoolProgressInsight
#      metadata:
#        name: worker
#      spec: {}
#      status:
#        name: master
#        conditions:
#        - type: Updating
#          status: "False"
#          lastTransitionTime: "2021-01-01T00:00:00Z"
#          reason: Updated
#          message: "All nodes on version 4.18.0"
#        scopeType: WorkerPool
#        assessment: Completed
#        completionPercent: 100
#        summaries:
#        - type: Total
#          count: 3
#        - type: Available
#          count: 3
#        - type: Progressing
#          count: 0
#        - type: Outdated
#          count: 0
#        - type: Draining
#          count: 0
#        - type: Excluded
#          count: 0
#        - type: Degraded
#          count: 0
#    expected: |
#      apiVersion: update.openshift.io/v1alpha1
#      kind: MachineConfigPoolProgressInsight
#      spec: {}
#    expectedStatusError: "TODO"

