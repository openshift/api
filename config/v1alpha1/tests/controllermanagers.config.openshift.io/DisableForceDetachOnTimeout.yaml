apiVersion: apiextensions.k8s.io/v1 # Hack because controller-gen complains if we don't have this
name: "ControllerManager"
crdName: controllermanagers.config.openshift.io
featureGates:
  - DisableForceDetachOnTimeout
tests:
  onCreate:
    - name: Should be able to create with default values
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout:
      expected: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Enabled
    - name: Should be able to create with force detach enabled
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Enabled
      expected: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Enabled
    - name: Should be able to create with force detach disabled
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Disabled
      expected: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Disabled
    - name: Should reject unsupported value of forceDetachOnTimeout
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: INVALID
      expectedError: "spec.forceDetachOnTimeout: Unsupported value: \"INVALID\": supported values: \"Enabled\", \"Disabled\""
  onUpdate:
    - name: Enabled to Disabled
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Enabled
      updated: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Disabled
      expected: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Disabled
    - name: Disabled to default value
      initial: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Disabled
      updated: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: 
      expected: |
        apiVersion: config.openshift.io/v1alpha1
        kind: ControllerManager
        spec:
          forceDetachOnTimeout: Enabled
