apiVersion: apiextensions.k8s.io/v1 # Hack because controller-gen complains if we don't have this
name: "APIServer"
crdName: apiservers.config.openshift.io
featureGates:
- KMSEncryption
- -KMSEncryptionProvider
tests:
  onCreate:
    - name: Should be able to create with KMS type without kms config
      initial: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          encryption:
            type: KMS
      expected: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          audit:
            profile: Default
          encryption:
            type: KMS
    - name: Should be able to create with aescbc encryption
      initial: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          encryption:
            type: aescbc
      expected: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          audit:
            profile: Default
          encryption:
            type: aescbc
    - name: Should be able to create with aesgcm encryption
      initial: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          encryption:
            type: aesgcm
      expected: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          audit:
            profile: Default
          encryption:
            type: aesgcm
    - name: Should be able to create with identity encryption
      initial: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          encryption:
            type: identity
      expected: |
        apiVersion: config.openshift.io/v1
        kind: APIServer
        spec:
          audit:
            profile: Default
          encryption:
            type: identity
