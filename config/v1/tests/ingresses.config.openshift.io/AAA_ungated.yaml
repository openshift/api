apiVersion: apiextensions.k8s.io/v1 # Hack because controller-gen complains if we don't have this
name: "Ingress"
crdName: ingresses.config.openshift.io
tests:
  onCreate:
    - name: Should be able to create a minimal Ingress
      initial: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec: {} # No spec is required for a Ingress
      expected: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec: {}
    - name: Should be able to create an Ingress with domain set
      initial: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
      expected: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
  onUpdate:
    - name: Should not be able to change domain once set
      initial: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
      updated: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: test.example.com
      expectedError: "domain is immutable once set"
    - name: Should be able to update other fields without changing domain
      initial: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
      updated: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
          appsDomain: custom.example.com
      expected: |
        apiVersion: config.openshift.io/v1
        kind: Ingress
        spec:
          domain: apps.example.com
          appsDomain: custom.example.com
